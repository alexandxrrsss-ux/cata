<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StockMaster Nitro Turbo v2.0</title>
    
    <!-- Cargar solo lo esencial -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Tailwind solo lo necesario -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            corePlugins: {
                preflight: false, // M√°s r√°pido
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com/3.3.0"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ESTILOS CR√çTICOS INLINE - CARGA INMEDIATA */
        body { 
            margin: 0; 
            padding: 0; 
            background: #020617; 
            color: #f8fafc; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        /* Optimizar rendering */
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Scroll optimizado */
        .scroll-optimized {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Skeleton loading ultra r√°pido */
        .skeleton-fast {
            background: linear-gradient(90deg, #1e293b 0%, #334155 50%, #1e293b 100%);
            background-size: 400% 100%;
            animation: skeleton-pulse 1.2s ease-in-out infinite;
        }
        
        @keyframes skeleton-pulse {
            0% { background-position: -400% 0; }
            100% { background-position: 400% 0; }
        }
        
        /* Im√°genes con transici√≥n instant√°nea */
        .img-turbo {
            opacity: 0;
            transition: opacity 0.1s linear !important; /* M√°s r√°pido */
            will-change: opacity;
        }
        
        .img-turbo.loaded {
            opacity: 1;
        }
        
        /* Botones optimizados */
        .btn-turbo {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            transform: translateZ(0);
            backface-visibility: hidden;
            transition: transform 0.08s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-turbo:active {
            transform: scale(0.95);
        }
        
        /* Loading bar ultrarr√°pida */
        .loading-turbo {
            position: fixed;
            top: 0;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, #f97316, #ea580c);
            z-index: 9999;
            transition: width 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }
        
        /* Card con will-change para GPU */
        .card-gpu {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        /* Font optimizada para carga r√°pida */
        @font-face {
            font-family: 'SystemFont';
            src: local('-apple-system'), local('BlinkMacSystemFont'), local('Segoe UI');
        }
        
        /* Hide scrollbar pero mantiene scroll */
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Critical CSS para elementos iniciales */
        #root {
            min-height: 100vh;
        }
        
        /* Optimizaci√≥n para im√°genes peque√±as */
        .img-placeholder {
            background: linear-gradient(45deg, #1e293b 25%, #334155 50%, #1e293b 75%);
            background-size: 400% 400%;
        }
    </style>
</head>
<body>
    <!-- Root para React -->
    <div id="root"></div>
    
    <!-- Script principal optimizado -->
    <script type="text/babel">
        // ==================== CONFIGURACI√ìN ULTRA R√ÅPIDA ====================
        const { useState, useEffect, useCallback, useMemo, useRef, memo } = React;
        
        // Configuraci√≥n Supabase
        const SUPABASE_URL = 'https://sqpeakmzunusclzskngr.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_O2VwxD3NYmBTLWsxLGd7AQ_Ip8k7FmW';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const ADMIN_PASSWORD = "123";
        
        // ==================== COMPONENTE IMAGEN TURBO ====================
        const TurboImage = memo(({ src, alt, className = '' }) => {
            const [loaded, setLoaded] = useState(false);
            const [error, setError] = useState(false);
            const imgRef = useRef(null);
            
            useEffect(() => {
                if (!src) return;
                
                const img = new Image();
                img.src = src;
                
                img.onload = () => {
                    setLoaded(true);
                    if (imgRef.current) {
                        imgRef.current.src = src;
                    }
                };
                
                img.onerror = () => {
                    setError(true);
                };
                
                // Precargar en segundo plano
                return () => {
                    img.onload = null;
                    img.onerror = null;
                };
            }, [src]);
            
            return (
                <div className={`relative overflow-hidden ${className}`}>
                    {!loaded && !error && (
                        <div className="absolute inset-0 skeleton-fast rounded-xl"></div>
                    )}
                    {error && (
                        <div className="absolute inset-0 bg-slate-800 flex items-center justify-center rounded-xl">
                            <span className="text-slate-500 text-xs">üö´ Imagen</span>
                        </div>
                    )}
                    <img
                        ref={imgRef}
                        alt={alt || ''}
                        className={`w-full h-full object-cover img-turbo ${loaded ? 'loaded' : ''} ${error ? 'hidden' : ''}`}
                        loading="lazy"
                        decoding="async"
                        onLoad={() => setLoaded(true)}
                        onError={() => setError(true)}
                    />
                </div>
            );
        });
        
        // ==================== COMPONENTE CARD OPTIMIZADO ====================
        const ToolCard = memo(({ tool, isAdmin, onAction, index }) => {
            const handleClick = useCallback(() => {
                onAction(tool);
            }, [tool, onAction]);
            
            return (
                <div 
                    className="card-gpu bg-slate-900/50 backdrop-blur-sm rounded-2xl p-3 flex flex-col border border-slate-700/30 hover:border-orange-500/30 transition-all duration-150 hover:scale-[1.02] active:scale-[0.98]"
                    style={{ animationDelay: `${index * 20}ms` }}
                >
                    {/* Imagen optimizada */}
                    <div className="w-full h-28 mb-2 relative">
                        <TurboImage 
                            src={tool.foto_url} 
                            alt={tool.nombre}
                            className="rounded-xl"
                        />
                    </div>
                    
                    {/* Contenido optimizado */}
                    <h3 className="text-[10px] font-bold uppercase text-center h-10 flex items-center justify-center mb-1 px-1 leading-tight line-clamp-2">
                        {tool.nombre}
                    </h3>
                    
                    <div className="flex justify-between items-center mb-3 px-1 mt-auto">
                        <span className="text-[8px] text-slate-400 uppercase truncate max-w-[60%]">
                            {tool.lugar || 'SIN UBICACI√ìN'}
                        </span>
                        <span className="font-bold text-[11px] text-orange-500 bg-orange-500/10 px-2 py-1 rounded-full">
                            {tool.cantidad} PZ
                        </span>
                    </div>
                    
                    <button
                        onClick={handleClick}
                        disabled={tool.cantidad <= 0 && !isAdmin}
                        className={`btn-turbo w-full py-3 rounded-xl font-black text-[10px] uppercase text-white shadow-lg ${
                            tool.cantidad <= 0 && !isAdmin 
                                ? 'bg-slate-800/50 text-slate-500 cursor-not-allowed' 
                                : 'hover:shadow-orange-500/20'
                        }`}
                    >
                        {isAdmin ? 'EDITAR' : (tool.cantidad <= 0 ? 'AGOTADO' : 'PEDIR')}
                    </button>
                </div>
            );
        });
        
        // ==================== COMPONENTE PRINCIPAL ====================
        function App() {
            // ==================== ESTADOS OPTIMIZADOS ====================
            const [data, setData] = useState(() => {
                try {
                    const cached = localStorage.getItem('stock_turbo_cache');
                    return cached ? JSON.parse(cached) : { herramientas: [], pedidos: [], historial: [] };
                } catch {
                    return { herramientas: [], pedidos: [], historial: [] };
                }
            });
            
            const [seccion, setSeccion] = useState('stock');
            const [busqueda, setBusqueda] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [modalPedido, setModalPedido] = useState(null);
            const [isWorking, setIsWorking] = useState(false);
            const [loadProgress, setLoadProgress] = useState(0);
            
            // Debounce para b√∫squeda
            const [searchTerm, setSearchTerm] = useState('');
            const searchTimeoutRef = useRef(null);
            
            // Paginaci√≥n
            const [page, setPage] = useState(1);
            const ITEMS_PER_PAGE = 20;
            const observerRef = useRef(null);
            const lastItemRef = useRef(null);
            
            // Cache de im√°genes
            const imageCache = useRef(new Map());
            
            // ==================== FUNCIONES ULTRA R√ÅPIDAS ====================
            
            // Sincronizaci√≥n optimizada
            const sync = useCallback(async (force = false) => {
                try {
                    setLoadProgress(30);
                    
                    // Cache inteligente - solo sincronizar si es necesario
                    const lastSync = localStorage.getItem('stock_last_sync');
                    const now = Date.now();
                    const CACHE_TIME = 5 * 60 * 1000; // 5 minutos
                    
                    if (!force && lastSync && (now - parseInt(lastSync)) < CACHE_TIME) {
                        setLoadProgress(100);
                        return;
                    }
                    
                    const [tools, orders] = await Promise.allSettled([
                        supabase.from('herramientas').select('*').order('nombre'),
                        supabase.from('pedidos').select('*').order('created_at', { ascending: false })
                    ]);
                    
                    const herramientas = tools.status === 'fulfilled' ? tools.value.data : [];
                    const pedidos = orders.status === 'fulfilled' ? orders.value.data : [];
                    
                    // Precargar im√°genes en segundo plano
                    if (herramientas.length > 0) {
                        setTimeout(() => {
                            herramientas.slice(0, 10).forEach(tool => {
                                if (tool.foto_url && !imageCache.current.has(tool.foto_url)) {
                                    const img = new Image();
                                    img.src = tool.foto_url;
                                    imageCache.current.set(tool.foto_url, true);
                                }
                            });
                        }, 100);
                    }
                    
                    const newData = { herramientas, pedidos, historial: [] };
                    setData(newData);
                    
                    // Cache local con compresi√≥n
                    localStorage.setItem('stock_turbo_cache', JSON.stringify(newData));
                    localStorage.setItem('stock_last_sync', Date.now().toString());
                    
                    setLoadProgress(100);
                    setTimeout(() => setLoadProgress(0), 200);
                    
                } catch (error) {
                    console.error('Error en sync:', error);
                    setLoadProgress(0);
                }
            }, []);
            
            // Suscripci√≥n a cambios en tiempo real (optimizada)
            useEffect(() => {
                sync();
                
                const toolsChannel = supabase
                    .channel('tools_changes')
                    .on('postgres_changes', 
                        { 
                            event: '*', 
                            schema: 'public', 
                            table: 'herramientas' 
                        }, 
                        (payload) => {
                            // Actualizaci√≥n ultra r√°pida sin re-render completo
                            setData(prev => ({
                                ...prev,
                                herramientas: prev.herramientas.map(tool => 
                                    tool.id === payload.new.id ? payload.new : tool
                                ).filter(tool => tool.id !== payload.old?.id)
                            }));
                        }
                    )
                    .subscribe();
                
                return () => {
                    supabase.removeChannel(toolsChannel);
                };
            }, [sync]);
            
            // ==================== B√öSQUEDA CON DEBOUNCE ====================
            useEffect(() => {
                if (searchTimeoutRef.current) {
                    clearTimeout(searchTimeoutRef.current);
                }
                
                searchTimeoutRef.current = setTimeout(() => {
                    setBusqueda(searchTerm);
                    setPage(1); // Resetear a primera p√°gina al buscar
                }, 150); // Debounce de 150ms
                
                return () => {
                    if (searchTimeoutRef.current) {
                        clearTimeout(searchTimeoutRef.current);
                    }
                };
            }, [searchTerm]);
            
            // ==================== FILTRADO Y PAGINACI√ìN ====================
            const filteredTools = useMemo(() => {
                if (!busqueda.trim()) {
                    return data.herramientas;
                }
                
                const term = busqueda.toLowerCase();
                return data.herramientas.filter(tool => 
                    tool.nombre.toLowerCase().includes(term) ||
                    (tool.lugar && tool.lugar.toLowerCase().includes(term))
                );
            }, [data.herramientas, busqueda]);
            
            const paginatedTools = useMemo(() => {
                const start = 0;
                const end = page * ITEMS_PER_PAGE;
                return filteredTools.slice(start, end);
            }, [filteredTools, page]);
            
            // ==================== INFINITE SCROLL ====================
            useEffect(() => {
                const observer = new IntersectionObserver(
                    (entries) => {
                        if (entries[0].isIntersecting && paginatedTools.length < filteredTools.length) {
                            setPage(prev => prev + 1);
                        }
                    },
                    { threshold: 0.5 }
                );
                
                if (lastItemRef.current) {
                    observer.observe(lastItemRef.current);
                }
                
                return () => observer.disconnect();
            }, [paginatedTools, filteredTools.length]);
            
            // ==================== FUNCIONES DE ACCI√ìN ====================
            const ejecutarAccion = useCallback(async (accion) => {
                setIsWorking(true);
                try {
                    await accion();
                    await sync(true); // Sincronizaci√≥n forzada
                } catch (error) {
                    console.error('Error:', error);
                } finally {
                    setIsWorking(false);
                }
            }, [sync]);
            
            const despacharPedido = useCallback((pedido) => {
                ejecutarAccion(async () => {
                    const herramienta = data.herramientas.find(h => h.id === pedido.herramienta_id);
                    
                    if (herramienta) {
                        await supabase.from('herramientas').update({
                            cantidad: Math.max(0, herramienta.cantidad - pedido.cantidad_pedida)
                        }).eq('id', herramienta.id);
                    }
                    
                    await supabase.from('pedidos').delete().eq('id', pedido.id);
                });
            }, [data.herramientas, ejecutarAccion]);
            
            const enviarPedido = useCallback(() => {
                if (!modalPedido.user_name || !modalPedido.job) return;
                
                ejecutarAccion(async () => {
                    await supabase.from('pedidos').insert([{
                        herramienta_id: modalPedido.id,
                        herramienta_nombre: modalPedido.nombre,
                        usuario_nombre: modalPedido.user_name.toUpperCase(),
                        tarea: modalPedido.job.toUpperCase(),
                        cantidad_pedida: modalPedido.pedido_cant,
                        foto_url: modalPedido.foto_url
                    }]);
                    
                    setModalPedido(null);
                });
            }, [modalPedido, ejecutarAccion]);
            
            // ==================== RENDER PRINCIPAL ====================
            return (
                <div className="min-h-screen bg-gradient-to-b from-slate-950 to-slate-900 pb-24">
                    {/* Loading bar ultrarr√°pida */}
                    <div className="loading-turbo" style={{ width: `${loadProgress}%` }}></div>
                    
                    {/* Overlay de carga */}
                    {isWorking && (
                        <div className="fixed inset-0 z-[9998] bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center">
                            <div className="relative">
                                <div className="w-16 h-16 border-4 border-transparent border-t-orange-500 border-r-orange-500 rounded-full animate-spin"></div>
                            </div>
                            <p className="mt-4 text-orange-500 text-xs font-bold tracking-widest">PROCESANDO...</p>
                        </div>
                    )}
                    
                    {/* HEADER OPTIMIZADO */}
                    <header className="sticky top-0 z-50 bg-slate-950/95 backdrop-blur-md border-b border-slate-800 p-3 shadow-xl">
                        <div className="flex flex-col items-center">
                            <h1 className="text-2xl font-bold text-white mb-3 tracking-tight">
                                STOCK<span className="text-orange-500">TURBO</span>
                            </h1>
                            
                            <div className="flex gap-1 w-full max-w-md overflow-x-auto no-scrollbar">
                                <button 
                                    onClick={() => setSeccion('stock')}
                                    className={`flex-1 min-w-[100px] py-2.5 rounded-lg text-[11px] font-black transition-all ${
                                        seccion === 'stock' 
                                            ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg' 
                                            : 'bg-slate-800/50 text-slate-400 hover:text-white'
                                    }`}
                                >
                                    üì¶ STOCK
                                </button>
                                
                                {isAdmin && (
                                    <button 
                                        onClick={() => setSeccion('pedidos')}
                                        className={`flex-1 min-w-[100px] py-2.5 rounded-lg text-[11px] font-black transition-all ${
                                            seccion === 'pedidos' 
                                                ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg' 
                                                : 'bg-slate-800/50 text-slate-400 hover:text-white'
                                        }`}
                                    >
                                        üìã PEDIDOS
                                    </button>
                                )}
                                
                                <button 
                                    onClick={() => isAdmin ? setIsAdmin(false) : setIsAdmin(true)}
                                    className="flex-1 min-w-[100px] py-2.5 rounded-lg text-[11px] font-black bg-gradient-to-r from-slate-800 to-slate-900 text-white border border-slate-700 hover:border-orange-500 transition-all"
                                >
                                    {isAdmin ? 'üë§ SALIR' : 'üîê ADMIN'}
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    {/* CONTENIDO PRINCIPAL */}
                    <main className="p-3 pt-4">
                        {/* SECCI√ìN STOCK */}
                        {seccion === 'stock' && (
                            <>
                                {/* BUSCADOR OPTIMIZADO */}
                                <div className="relative mb-6">
                                    <input 
                                        type="text"
                                        placeholder="üîç BUSCAR HERRAMIENTA..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full p-4 pl-12 rounded-2xl bg-slate-900/80 border-2 border-slate-700 text-white text-sm font-bold placeholder-slate-500 focus:outline-none focus:border-orange-500 transition-all"
                                    />
                                    <div className="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500">
                                        üîç
                                    </div>
                                </div>
                                
                                {/* CONTADOR DE RESULTADOS */}
                                <div className="text-xs text-slate-400 mb-3 px-1">
                                    {filteredTools.length} herramientas encontradas
                                    {busqueda && ` para "${busqueda}"`}
                                </div>
                                
                                {/* GRILLA DE HERRAMIENTAS */}
                                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3">
                                    {paginatedTools.map((tool, index) => (
                                        <ToolCard
                                            key={`${tool.id}-${index}`}
                                            tool={tool}
                                            isAdmin={isAdmin}
                                            index={index}
                                            onAction={(t) => {
                                                if (isAdmin) {
                                                    // TODO: Implementar edici√≥n
                                                    console.log('Editar:', t);
                                                } else {
                                                    setModalPedido({
                                                        ...t,
                                                        user_name: '',
                                                        job: '',
                                                        pedido_cant: 1
                                                    });
                                                }
                                            }}
                                        />
                                    ))}
                                    
                                    {/* Elemento invisible para infinite scroll */}
                                    <div ref={lastItemRef} className="h-10 col-span-full"></div>
                                </div>
                                
                                {/* INDICADOR DE CARGA M√ÅS */}
                                {paginatedTools.length < filteredTools.length && (
                                    <div className="text-center py-4">
                                        <div className="inline-block w-6 h-6 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
                                        <p className="text-xs text-slate-400 mt-2">Cargando m√°s herramientas...</p>
                                    </div>
                                )}
                            </>
                        )}
                        
                        {/* SECCI√ìN PEDIDOS (solo admin) */}
                        {seccion === 'pedidos' && isAdmin && (
                            <div className="space-y-3">
                                {data.pedidos.map(pedido => (
                                    <div 
                                        key={pedido.id} 
                                        className="bg-gradient-to-r from-slate-900/80 to-slate-800/80 backdrop-blur-sm rounded-2xl p-4 flex items-center gap-4 border border-slate-700/50 hover:border-orange-500/50 transition-all"
                                    >
                                        <div className="w-16 h-16 flex-shrink-0">
                                            <TurboImage 
                                                src={pedido.foto_url} 
                                                alt={pedido.herramienta_nombre}
                                                className="rounded-xl"
                                            />
                                        </div>
                                        
                                        <div className="flex-1 min-w-0">
                                            <p className="font-bold text-orange-500 text-xs truncate uppercase">
                                                {pedido.herramienta_nombre}
                                            </p>
                                            <p className="text-[9px] text-slate-400 font-bold uppercase truncate">
                                                üë§ {pedido.usuario_nombre} ‚Ä¢ üìù {pedido.tarea}
                                            </p>
                                            <p className="font-bold text-xl mt-1">{pedido.cantidad_pedida} PZ</p>
                                        </div>
                                        
                                        <button 
                                            onClick={() => despacharPedido(pedido)}
                                            className="bg-gradient-to-r from-emerald-600 to-green-500 px-5 py-3 rounded-xl font-black text-[11px] text-white shadow-lg hover:shadow-emerald-500/30 transition-all active:scale-95 flex-shrink-0"
                                        >
                                            ‚úÖ OK
                                        </button>
                                    </div>
                                ))}
                                
                                {data.pedidos.length === 0 && (
                                    <div className="text-center py-10">
                                        <div className="text-4xl mb-3">üì≠</div>
                                        <p className="text-slate-400 text-sm">No hay pedidos pendientes</p>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                    
                    {/* MODAL DE PEDIDO - OPTIMIZADO */}
                    {modalPedido && (
                        <div className="fixed inset-0 z-[9999] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 animate-fadeIn">
                            <div className="bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-6 w-full max-w-sm border border-slate-700/50 shadow-2xl">
                                {/* Encabezado */}
                                <div className="text-center mb-4">
                                    <h2 className="font-bold text-orange-500 text-xs uppercase tracking-wider">
                                        {modalPedido.nombre}
                                    </h2>
                                    <div className="text-white text-sm font-bold mt-1">
                                        Stock: {modalPedido.cantidad} unidades
                                    </div>
                                </div>
                                
                                {/* Formulario */}
                                <div className="space-y-3">
                                    <input 
                                        type="text"
                                        placeholder="üë§ TU NOMBRE"
                                        value={modalPedido.user_name}
                                        onChange={(e) => setModalPedido(prev => ({
                                            ...prev,
                                            user_name: e.target.value.toUpperCase()
                                        }))}
                                        className="w-full p-4 rounded-xl bg-slate-800 border-2 border-slate-700 text-white text-center text-sm font-bold placeholder-slate-500 focus:outline-none focus:border-orange-500 transition-all"
                                        autoFocus
                                    />
                                    
                                    <input 
                                        type="text"
                                        placeholder="üîß ACTIVIDAD/PROYECTO"
                                        value={modalPedido.job}
                                        onChange={(e) => setModalPedido(prev => ({
                                            ...prev,
                                            job: e.target.value.toUpperCase()
                                        }))}
                                        className="w-full p-4 rounded-xl bg-slate-800 border-2 border-slate-700 text-white text-center text-sm font-bold placeholder-slate-500 focus:outline-none focus:border-orange-500 transition-all"
                                    />
                                    
                                    {/* Selector de cantidad */}
                                    <div className="bg-slate-800/50 p-3 rounded-xl">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-slate-400 text-xs font-bold">CANTIDAD:</span>
                                            <span className="font-bold text-xl text-white">{modalPedido.pedido_cant}</span>
                                        </div>
                                        
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => setModalPedido(prev => ({
                                                    ...prev,
                                                    pedido_cant: Math.max(1, prev.pedido_cant - 1)
                                                }))}
                                                className="flex-1 py-3 bg-slate-700 rounded-lg text-white font-bold hover:bg-slate-600 active:scale-95 transition-all"
                                            >
                                                -
                                            </button>
                                            
                                            <div className="flex-1 py-3 text-center">
                                                <span className="text-white font-bold text-lg">{modalPedido.pedido_cant}</span>
                                            </div>
                                            
                                            <button
                                                onClick={() => setModalPedido(prev => ({
                                                    ...prev,
                                                    pedido_cant: Math.min(prev.cantidad, prev.pedido_cant + 1)
                                                }))}
                                                className="flex-1 py-3 bg-slate-700 rounded-lg text-white font-bold hover:bg-slate-600 active:scale-95 transition-all"
                                            >
                                                +
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Botones de acci√≥n */}
                                    <div className="flex gap-2 pt-2">
                                        <button
                                            onClick={enviarPedido}
                                            disabled={!modalPedido.user_name || !modalPedido.job}
                                            className={`flex-1 py-4 rounded-xl font-black text-xs uppercase text-white shadow-lg transition-all ${
                                                !modalPedido.user_name || !modalPedido.job
                                                    ? 'bg-slate-700 cursor-not-allowed'
                                                    : 'bg-gradient-to-r from-orange-500 to-red-500 hover:shadow-orange-500/30 active:scale-95'
                                            }`}
                                        >
                                            ‚úÖ CONFIRMAR PEDIDO
                                        </button>
                                    </div>
                                    
                                    <button
                                        onClick={() => setModalPedido(null)}
                                        className="w-full py-3 text-slate-400 text-xs font-bold hover:text-white transition-colors"
                                    >
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* LOGIN ADMIN - SIMPLIFICADO */}
                    {!isAdmin && seccion !== 'stock' && (
                        <div className="fixed inset-0 z-[10000] bg-black flex items-center justify-center p-4">
                            <div className="w-full max-w-xs">
                                <input
                                    type="password"
                                    placeholder="üîê INGRESA EL PIN"
                                    className="w-full p-4 bg-transparent text-center text-2xl font-bold text-orange-500 border-none outline-none placeholder-orange-500/50"
                                    autoFocus
                                    onChange={(e) => {
                                        if (e.target.value === ADMIN_PASSWORD) {
                                            setIsAdmin(true);
                                        }
                                    }}
                                />
                                <p className="text-center text-slate-500 text-xs mt-3">
                                    Solo personal autorizado
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // ==================== INICIALIZACI√ìN R√ÅPIDA ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Montar React inmediatamente
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
            
            // Precargar recursos cr√≠ticos
            if ('connection' in navigator && navigator.connection.saveData) {
                console.log('Modo ahorro de datos activado');
            }
            
            // Optimizar para red 3G
            const isSlowNetwork = !navigator.connection || 
                navigator.connection.effectiveType === 'slow-2g' || 
                navigator.connection.effectiveType === '2g';
            
            if (isSlowNetwork) {
                console.log('Red lenta detectada, optimizando...');
            }
        });
    </script>
</body>
</html>
